version: '3'

services:
  app-server:
    image: busybox:latest
    networks:
      - envoy-pilot_xds-demo
    command: "sh -c 'while true; do sleep 1000; done'"
  envoy:
    image: envoyproxy/envoy:v1.7.0
    volumes:
      - $PWD/config-cds-lds.yaml:/config.yaml
    command: ["envoy", "-c", "/config.yaml", "--v2-config-only", "-l", "debug", "--service-cluster","cdstest-cluster","--service-node","cdstest-node"]
    ports:
      - "9901:9901"
    networks:
      - envoy-pilot_xds-demo
  envoy-ads:
    image: envoyproxy/envoy:v1.7.0
    volumes:
      - $PWD/config-ads.yaml:/config.yaml
    command: ["envoy", "-c", "/config.yaml", "--v2-config-only", "-l", "debug", "--service-cluster","cdstest-cluster","--service-node","cdstest-node"]
    ports:
      - "9902:9901"
    networks:
      - envoy-pilot_xds-demo

networks:
  envoy-pilot_xds-demo:
    external: true