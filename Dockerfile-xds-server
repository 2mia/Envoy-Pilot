FROM tak2siva/xds-build:v0.1.1

RUN mkdir /go/src/Envoy-Pilot
ADD cmd /go/src/Envoy-Pilot/cmd
ADD lib /go/src/Envoy-Pilot/lib

RUN rm -rf  /go/src/github.com/envoyproxy/go-control-plane/vendor
RUN go build -o /go/bin/Envoy-Pilot /go/src/Envoy-Pilot/cmd/server/main.go

WORKDIR /go/bin
CMD ["./Envoy-Pilot"]